<Window x:Class="VirtualizingWrapPanelSamples.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:VirtualizingWrapPanelSamples"
        xmlns:wpftk="clr-namespace:WpfToolkit.Controls;assembly=VirtualizingWrapPanel"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        mc:Ignorable="d"
        x:Name="window"
        Title="VirtualizingWrapPanel Samples"
        Width="1400"
        Height="1000">

    <Window.Resources>
        <Style TargetType="TextBox" BasedOn="{StaticResource AppTextBoxStyle}"/>
        <local:ColorToBrushConverter x:Key="ColorToBrushConverter" />
        <local:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter" />
        <DataTemplate x:Key="ItemTemplate" DataType="local:TestItem">
            <Grid
                MinWidth="100"
                MinHeight="100"
                Background="{Binding Background, Mode=OneWay, Converter={StaticResource ColorToBrushConverter}}"
                HorizontalAlignment="Stretch"
                VerticalAlignment="Stretch"
                Loaded="Item_Loaded"
                Unloaded="Item_Unloaded">
                <Grid.ContextMenu>
                    <ContextMenu>
                        <MenuItem Header="Remove" Click="RemoveMenuItem_Click"/>
                    </ContextMenu>
                </Grid.ContextMenu>
                <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                    <TextBlock
                        Foreground="Black"
                        FontSize="20"     
                        TextAlignment="Center"
                        Text="{Binding Number, Mode=OneWay}"
                        Padding="4" />
                    <TextBlock
                        Foreground="Black"
                        TextAlignment="Center"
                        Text="{Binding CurrentDateTime, Mode=OneTime, StringFormat='{}{0:HH:mm:ss}'}"
                        Padding="4" />
                </StackPanel>
            </Grid>
        </DataTemplate>
        <DataTemplate x:Key="RandomSizedItemTemplateLazy" DataType="local:TestItem">
            <Grid
                MinWidth="{Binding SizeLazy.Width, Mode=OneWay}"
                MinHeight="{Binding SizeLazy.Height, Mode=OneWay}"
                Background="{Binding Background, Mode=OneWay, Converter={StaticResource ColorToBrushConverter}}"
                HorizontalAlignment="Stretch"
                VerticalAlignment="Stretch"
                Loaded="Item_Loaded"
                Unloaded="Item_Unloaded">
                <Grid.ContextMenu>
                    <ContextMenu>
                        <MenuItem Header="Remove" Click="RemoveMenuItem_Click"/>
                    </ContextMenu>
                </Grid.ContextMenu>
                <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                    <TextBlock    
                        Foreground="Black"
                        FontSize="20"
                        TextAlignment="Center"
                        Text="{Binding Number, Mode=OneWay}"
                        Padding="4" />
                    <TextBlock
                        Foreground="Black"
                        TextAlignment="Center"
                        Text="{Binding CurrentDateTime, Mode=OneTime, StringFormat='{}{0:HH:mm:ss}'}"
                        Padding="4" />
                </StackPanel>
            </Grid>
        </DataTemplate>
        <DataTemplate x:Key="RandomSizedItemTemplate" DataType="local:TestItem">
            <Grid
                MinWidth="{Binding Size.Width, Mode=OneWay}"
                MinHeight="{Binding Size.Height, Mode=OneWay}"
                Background="{Binding Background, Mode=OneWay, Converter={StaticResource ColorToBrushConverter}}"
                HorizontalAlignment="Stretch"
                VerticalAlignment="Stretch"
                Loaded="Item_Loaded"
                Unloaded="Item_Unloaded">
                <Grid.ContextMenu>
                    <ContextMenu>
                        <MenuItem Header="Remove" Click="RemoveMenuItem_Click"/>
                    </ContextMenu>
                </Grid.ContextMenu>
                <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                    <TextBlock 
                        Foreground="Black"
                        FontSize="20"
                        TextAlignment="Center"
                        Text="{Binding Number, Mode=OneWay}"
                        Padding="4" />
                    <TextBlock
                        Foreground="Black"
                        TextAlignment="Center"
                        Text="{Binding CurrentDateTime, Mode=OneTime, StringFormat='{}{0:HH:mm:ss}'}"
                        Padding="4" />
                </StackPanel>
            </Grid>
        </DataTemplate>
        <Style x:Key="ItemContainerStyle" TargetType="{x:Type ListViewItem}">
            <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
            <Setter Property="VerticalContentAlignment" Value="Stretch"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Padding" Value="4"/>
        </Style>
        <GroupStyle x:Key="GroupStyle" HidesIfEmpty="True">
            <GroupStyle.HeaderTemplate>
                <DataTemplate>
                    <TextBlock
                        Foreground="Black"
                        Background="LightGray"
                        Padding="8"
                        HorizontalAlignment="Stretch" 
                        FontWeight="Bold" 
                        FontSize="14"
                        Text="{Binding Name, StringFormat=Group {0}}" />
                </DataTemplate>
            </GroupStyle.HeaderTemplate>
            <GroupStyle.Panel>
                <ItemsPanelTemplate>
                    <VirtualizingStackPanel
                        Orientation="{Binding DataContext.OrientationGroupPanel, Mode=OneWay, ElementName=window}" />
                </ItemsPanelTemplate>
            </GroupStyle.Panel>
            <GroupStyle.ContainerStyle>
                <!-- orginal WPF style but with zero Margin on the ItemsPresenter -->
                <Style TargetType="{x:Type GroupItem}">
                    <Setter Property="Control.Template">
                        <Setter.Value>
                            <ControlTemplate TargetType="{x:Type GroupItem}">
                                <StackPanel>
                                    <ContentPresenter
                                        Content="{TemplateBinding ContentControl.Content}"
                                        ContentTemplate="{TemplateBinding ContentControl.ContentTemplate}"
                                        ContentStringFormat="{TemplateBinding ContentControl.ContentStringFormat}"
                                        Name="PART_Header" />
                                    <ItemsPresenter Name="ItemsPresenter" Margin="0" />
                                </StackPanel>
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                </Style>
            </GroupStyle.ContainerStyle>
        </GroupStyle>
    </Window.Resources>

    <DockPanel Margin="8">
        <ScrollViewer 
            DockPanel.Dock="Left"
            Padding="0,0,16,0"
            Margin="0,0,4,0"
            Width="200"
            VerticalScrollBarVisibility="Auto">
            <StackPanel>
                <StackPanel.Resources>
                    <Style x:Key="HeaderStyle" TargetType="TextBlock">
                        <Setter Property="FontSize" Value="11"/>
                        <Setter Property="Margin" Value="0"/>
                        <Setter Property="Padding" Value="2,3,0,4"/>
                    </Style>
                </StackPanel.Resources>

                <TextBlock Style="{StaticResource HeaderStyle}" Text="Orientation" />
                <ComboBox
                    ItemsSource="{Binding AvailableOrientations, Mode=OneTime}"
                    SelectedItem="{Binding Orientation, Mode=TwoWay}" />

                <TextBlock Margin="0,12,0,0" Style="{StaticResource HeaderStyle}" Text="SpacingMode" />
                <ComboBox
                    ItemsSource="{Binding AvailableSpacingModes, Mode=OneTime}"
                    SelectedItem="{Binding SpacingMode, Mode=TwoWay}" />

                <CheckBox Margin="0,12,0,0" IsChecked="{Binding StretchItems, Mode=TwoWay}" Content="StretchItems"/>

                <CheckBox Margin="0,6,0,0" Checked="GroupingCheckBox_Checked" Unchecked="GroupingCheckBox_Unchecked" Content="Grouping"/>

                <TextBlock Margin="0,10,0,0" Style="{StaticResource HeaderStyle}" Text="ItemSize" />
                <TextBox Margin="0,2,0,0" Text="{Binding ItemSize, Mode=TwoWay, UpdateSourceTrigger=LostFocus}"/>

                <CheckBox Margin="0,12,0,0" IsChecked="{Binding IsGridLayoutEnabled, Mode=TwoWay}" Content="IsGridLayoutEnabled"/>

                <TextBlock Margin="0,10,0,0" Style="{StaticResource HeaderStyle}" Text="CacheUnit" />
                <ComboBox
                    ItemsSource="{Binding AvailableCacheUnits, Mode=OneTime}"
                    SelectedItem="{Binding CacheUnit, Mode=TwoWay}" />

                <TextBlock Margin="0,4,0,0" Style="{StaticResource HeaderStyle}" Text="CacheLength" />
                <TextBox Text="{Binding CacheLength, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />

                <TextBlock Margin="0,12,0,0" Style="{StaticResource HeaderStyle}" Text="VirtualizationMode" />
                <ComboBox
                    ItemsSource="{Binding AvailableVirtualizationModes, Mode=OneTime}"
                    SelectedItem="{Binding VirtualizationMode, Mode=TwoWay}" />

                <TextBlock Margin="0,12,0,0" Style="{StaticResource HeaderStyle}" Text="ScrollUnit" />
                <ComboBox
                    ItemsSource="{Binding AvailableScrollUnits, Mode=OneTime}"
                    SelectedItem="{Binding ScrollUnit, Mode=TwoWay}" />

                <StackPanel Visibility="{Binding IsScrollByPixel, Converter={StaticResource BoolToVisibilityConverter}}">
                    <TextBlock Margin="0,4,0,0" Style="{StaticResource HeaderStyle}" Text="ScrollLineDelta" />
                    <TextBox
                        Text="{Binding ScrollLineDelta, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                    <TextBlock Margin="0,4,0,0" Style="{StaticResource HeaderStyle}" Text="MouseWheelDelta" />
                    <TextBox
                        Text="{Binding MouseWheelDelta, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                </StackPanel>
                <StackPanel Visibility="{Binding IsScrollByItem, Converter={StaticResource BoolToVisibilityConverter}}">
                    <TextBlock Margin="0,4,0,0" Style="{StaticResource HeaderStyle}" Text="ScrollLineDelta" />
                    <TextBox
                        Text="{Binding ScrollLineDeltaItem, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                    <TextBlock Margin="0,4,0,0" Style="{StaticResource HeaderStyle}" Text="MouseWheelDelta" />
                    <TextBox
                        Text="{Binding MouseWheelDeltaItem, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                </StackPanel>

                <TextBlock Margin="0,12,0,0" Style="{StaticResource HeaderStyle}" Text="HorizontalScrollBarVisibility" />
                <ComboBox
                    ItemsSource="{Binding AvailableScrollBarVisibilities, Mode=OneTime}"
                    SelectedItem="{Binding HorizontalScrollBarVisibility, Mode=TwoWay}" />
                <TextBlock Margin="0,4,0,0" Style="{StaticResource HeaderStyle}" Text="VerticalScrollBarVisibility" />
                <ComboBox
                    ItemsSource="{Binding AvailableScrollBarVisibilities, Mode=OneTime}"
                    SelectedItem="{Binding VerticalScrollBarVisibility, Mode=TwoWay}" />

                <TextBlock Margin="0,12,0,0" Style="{StaticResource HeaderStyle}" Text="Filter (Number >)" />
                <TextBox x:Name="filterTextBox" TextChanged="FilterTextBox_TextChanged" />

                <TextBlock Margin="0,12,0,0" Style="{StaticResource HeaderStyle}" Text="ScrollIntoView"/>
                <Grid>
                    <TextBox
                        x:Name="scrollIntoViewTextBox"
                        TextChanged="ScrollIntoViewTextBox_TextChanged"
                        KeyDown="ScrollIntoViewTextBox_KeyDown"
                        LostFocus="ScrollIntoViewTextBox_LostFocus"/>
                    <TextBlock 
                        x:Name="scrollIntoViewTextBoxPlaceholder"
                        Margin="14,7,0,0"
                        Text="Type number and press Enter"
                        FontSize="12" 
                        Foreground="Gray"
                        IsHitTestVisible="False"/>
                </Grid>
            </StackPanel>
        </ScrollViewer>

        <Grid Margin="0,0,0,8" DockPanel.Dock="Top">
            <Grid.Resources>
                <Style TargetType="TextBlock">
                    <Setter Property="FontSize" Value="13"/>
                    <Setter Property="VerticalAlignment" Value="Center"/>
                </Style>
            </Grid.Resources>
            <StackPanel Orientation="Horizontal">
                <TextBlock Text="Realized Items: " />
                <TextBlock Text="{Binding RenderedItemsCount, Mode=OneWay}" />
            </StackPanel>
            <StackPanel HorizontalAlignment="Right" Orientation="Horizontal">
                <TextBlock Text="Memory Usage: "/>
                <TextBlock Text="{Binding MemoryUsageInMB, Mode=OneWay}"/>
                <TextBlock Text=" MB"/>
                <Button
                    Margin="4,0,0,0"
                    Padding="4"
                    FontFamily="Segoe MDL2 Assets"
                    Content="&#xE149;"
                    FontSize="13"
                    ToolTip="Refresh"
                    Click="RefreshMemoryUsageButton_Click"
                    VerticalAlignment="Center" />
                <CheckBox
                    Margin="4,0,0,0"
                    MinHeight="0"
                    MinWidth="0"
                    ToolTip="Auto Refresh"
                    IsChecked="{Binding IsAutoRefreshMemoryUsageEnabled, Mode=TwoWay}"
                    VerticalAlignment="Center" />
            </StackPanel>
        </Grid>

        <Grid DockPanel.Dock="Bottom" Margin="0,8,0,0" ColumnDefinitions="*,*,*,*,*">
            <Button Grid.Column="0" Margin="0" HorizontalAlignment="Stretch" Content="Add item" Click="InsertButton_Click" />
            <Button Grid.Column="1" Margin="8,0,0,0" HorizontalAlignment="Stretch" Content="Add 10000 items" Click="FillButton_Click" />
            <Button Grid.Column="2" Margin="8,0,0,0" HorizontalAlignment="Stretch" Content="Remove random item" Click="RemoveButton_Click" />
            <Button Grid.Column="3" Margin="8,0,0,0" HorizontalAlignment="Stretch" Content="Remove all items" Click="ClearButton_Click" />
            <Button Grid.Column="4" Margin="8,0,0,0" HorizontalAlignment="Stretch" Content="Randomize" Click="Random_Click" />
        </Grid>

        <TabControl 
            x:Name="tabControl"
            SelectionChanged="TabControl_SelectionChanged"
            Padding="4,8,4,0">
            <TabControl.Resources>
                <Style TargetType="TabItem" BasedOn="{StaticResource DefaultTabItemStyle}">
                    <Setter Property="Padding" Value="8,0,8,0"/>
                </Style>
                <Style x:Key="ItemsControlStyle" TargetType="ItemsControl">
                    <Setter Property="BorderBrush" Value="Gray"/>
                    <Setter Property="BorderThickness" Value="1"/>
                    <Setter Property="Background" Value="Transparent"/>
                    <Setter Property="Margin" Value="0,4,0,0"/>
                </Style>
                <Style x:Key="DescriptionAndOptionsBarStyle" TargetType="StackPanel">
                    <Setter Property="Orientation" Value="Horizontal"/>
                    <Setter Property="Height" Value="32"/>
                </Style>
            </TabControl.Resources>
            <TabItem Header="VirtualizingWrapPanel">
                <DockPanel>
                    <StackPanel DockPanel.Dock="Top" Style="{StaticResource DescriptionAndOptionsBarStyle}">
                        <TextBlock VerticalAlignment="Center" Text="A VirtualizingWrapPanel used by a ListView as ItemsPanel." />
                    </StackPanel>
                    <ListView
                        Style="{StaticResource ItemsControlStyle}"
                        ItemTemplate="{StaticResource ItemTemplate}"
                        VirtualizingPanel.CacheLengthUnit="{Binding CacheUnit, Mode=OneWay}"
                        VirtualizingPanel.CacheLength="{Binding CacheLength, Mode=OneWay}"
                        VirtualizingPanel.ScrollUnit="{Binding ScrollUnit, Mode=OneWay}"
                        VirtualizingPanel.VirtualizationMode="{Binding VirtualizationMode, Mode=OneWay}"
                        VirtualizingPanel.IsVirtualizingWhenGrouping="True"
                        ScrollViewer.HorizontalScrollBarVisibility="{Binding HorizontalScrollBarVisibility, Mode=OneWay}"
                        ScrollViewer.VerticalScrollBarVisibility="{Binding VerticalScrollBarVisibility, Mode=OneWay}"
                        ItemContainerStyle="{StaticResource ItemContainerStyle}">
                        <ListView.ItemsPanel>
                            <ItemsPanelTemplate>
                                <wpftk:VirtualizingWrapPanel
                                    Orientation="{Binding DataContext.Orientation, Mode=OneWay, ElementName=window}"
                                    SpacingMode="{Binding DataContext.SpacingMode, Mode=OneWay, ElementName=window}"   
                                    ScrollLineDelta="{Binding DataContext.ScrollLineDelta, Mode=OneWay, ElementName=window}"
                                    MouseWheelDelta="{Binding DataContext.MouseWheelDelta, Mode=OneWay, ElementName=window}"
                                    ScrollLineDeltaItem="{Binding DataContext.ScrollLineDeltaItem, Mode=OneWay, ElementName=window}"
                                    MouseWheelDeltaItem="{Binding DataContext.MouseWheelDeltaItem, Mode=OneWay, ElementName=window}"
                                    StretchItems="{Binding DataContext.StretchItems, Mode=OneWay, ElementName=window}"
                                    ItemSize="{Binding DataContext.ItemSize, Mode=OneWay, ElementName=window}"
                                    IsGridLayoutEnabled="{Binding DataContext.IsGridLayoutEnabled, Mode=OneWay, ElementName=window}"/>
                            </ItemsPanelTemplate>
                        </ListView.ItemsPanel>
                    </ListView>
                </DockPanel>
            </TabItem>
            <TabItem Header="AllowDifferentSizedItems">
                <DockPanel>
                    <StackPanel DockPanel.Dock="Top" Style="{StaticResource DescriptionAndOptionsBarStyle}">
                        <TextBlock VerticalAlignment="Center" Text="A VirtualizingWrapPanel with AllowDifferentSizedItems=True used by a ListView as ItemsPanel." />
                        <CheckBox VerticalAlignment="Center" Margin="16,0,0,0" IsChecked="{Binding UseLazyLoadingItems, Mode=TwoWay}" Content="Lazy loading items"/>
                        <CheckBox VerticalAlignment="Center" Margin="16,0,0,0" IsChecked="{Binding UseItemSizeProvider, Mode=TwoWay}" Content="Use ItemSizeProvider"/>
                        <TextBlock VerticalAlignment="Center" Margin="16,0,0,0" Text="ItemAlignment"/>
                        <ComboBox Margin="4,0,0,0" ItemsSource="{Binding AvailableItemAlignments, Mode=OneTime}" SelectedItem="{Binding ItemAlignment, Mode=TwoWay}"/>
                    </StackPanel>
                    <ListView
                        x:Name="listViewAllowDifferentSizedItems"
                        Style="{StaticResource ItemsControlStyle}"
                        ItemTemplate="{StaticResource RandomSizedItemTemplate}"
                        VirtualizingPanel.CacheLengthUnit="{Binding CacheUnit, Mode=OneWay}"
                        VirtualizingPanel.CacheLength="{Binding CacheLength, Mode=OneWay}"
                        VirtualizingPanel.ScrollUnit="{Binding ScrollUnit, Mode=OneWay}"
                        VirtualizingPanel.VirtualizationMode="{Binding VirtualizationMode, Mode=OneWay}"
                        VirtualizingPanel.IsVirtualizingWhenGrouping="True"
                        ScrollViewer.HorizontalScrollBarVisibility="{Binding HorizontalScrollBarVisibility, Mode=OneWay}"
                        ScrollViewer.VerticalScrollBarVisibility="{Binding VerticalScrollBarVisibility, Mode=OneWay}"
                        ItemContainerStyle="{StaticResource ItemContainerStyle}">
                        <ListView.ItemsPanel>
                            <ItemsPanelTemplate>
                                <wpftk:VirtualizingWrapPanel
                                    Orientation="{Binding DataContext.Orientation, Mode=OneWay, ElementName=window}"
                                    SpacingMode="{Binding DataContext.SpacingMode, Mode=OneWay, ElementName=window}"   
                                    ScrollLineDelta="{Binding DataContext.ScrollLineDelta, Mode=OneWay, ElementName=window}"
                                    MouseWheelDelta="{Binding DataContext.MouseWheelDelta, Mode=OneWay, ElementName=window}"
                                    ScrollLineDeltaItem="{Binding DataContext.ScrollLineDeltaItem, Mode=OneWay, ElementName=window}"
                                    MouseWheelDeltaItem="{Binding DataContext.MouseWheelDeltaItem, Mode=OneWay, ElementName=window}"
                                    StretchItems="{Binding DataContext.StretchItems, Mode=OneWay, ElementName=window}"
                                    ItemSize="{Binding DataContext.ItemSize, Mode=OneWay, ElementName=window}"
                                    IsGridLayoutEnabled="{Binding DataContext.IsGridLayoutEnabled, Mode=OneWay, ElementName=window}"
                                    AllowDifferentSizedItems="True"
                                    ItemAlignment="{Binding DataContext.ItemAlignment, Mode=OneWay, ElementName=window}"/>
                            </ItemsPanelTemplate>
                        </ListView.ItemsPanel>
                    </ListView>
                </DockPanel>
            </TabItem>
            <TabItem Header="VirtualizingItemsControl">
                <DockPanel>
                    <StackPanel DockPanel.Dock="Top" Style="{StaticResource DescriptionAndOptionsBarStyle}">
                        <TextBlock VerticalAlignment="Center" Text="A VirtualizingWrapPanel used by a VirtualizingItemsControl." />
                    </StackPanel>
                    <wpftk:VirtualizingItemsControl
                        Style="{StaticResource ItemsControlStyle}"
                        ItemTemplate="{StaticResource ItemTemplate}"
                        VirtualizingPanel.CacheLengthUnit="{Binding CacheUnit, Mode=OneWay}"
                        VirtualizingPanel.CacheLength="{Binding CacheLength, Mode=OneWay}"
                        VirtualizingPanel.ScrollUnit="{Binding ScrollUnit, Mode=OneWay}"
                        VirtualizingPanel.VirtualizationMode="{Binding VirtualizationMode, Mode=OneWay}"
                        VirtualizingPanel.IsVirtualizingWhenGrouping="True"
                        ScrollViewer.HorizontalScrollBarVisibility="{Binding HorizontalScrollBarVisibility, Mode=OneWay}"
                        ScrollViewer.VerticalScrollBarVisibility="{Binding VerticalScrollBarVisibility, Mode=OneWay}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <wpftk:VirtualizingWrapPanel
                                    Orientation="{Binding DataContext.Orientation, Mode=OneWay, ElementName=window}"
                                    SpacingMode="{Binding DataContext.SpacingMode, Mode=OneWay, ElementName=window}"   
                                    ScrollLineDelta="{Binding DataContext.ScrollLineDelta, Mode=OneWay, ElementName=window}"
                                    MouseWheelDelta="{Binding DataContext.MouseWheelDelta, Mode=OneWay, ElementName=window}"
                                    ScrollLineDeltaItem="{Binding DataContext.ScrollLineDeltaItem, Mode=OneWay, ElementName=window}"
                                    MouseWheelDeltaItem="{Binding DataContext.MouseWheelDeltaItem, Mode=OneWay, ElementName=window}"
                                    StretchItems="{Binding DataContext.StretchItems, Mode=OneWay, ElementName=window}"
                                    ItemSize="{Binding DataContext.ItemSize, Mode=OneWay, ElementName=window}"
                                    IsGridLayoutEnabled="{Binding DataContext.IsGridLayoutEnabled, Mode=OneWay, ElementName=window}"/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                    </wpftk:VirtualizingItemsControl>
                </DockPanel>
            </TabItem>
            <TabItem Header="GridView">
                <DockPanel>
                    <Grid DockPanel.Dock="Top" Height="32">
                        <TextBlock 
                            VerticalAlignment="Center"
                            Text="The GridView control is a easy to use control displaying a grid of items using a VirtualizingWrapPanel." />
                        <CheckBox 
                            HorizontalAlignment="Right" 
                            IsChecked="{Binding IsWrappingKeyboardNavigationEnabled, Mode=TwoWay}"
                            Content="Enable wrapping keyboard navigation"/>
                    </Grid>
                    <wpftk:GridView
                        Style="{StaticResource ItemsControlStyle}"
                        IsWrappingKeyboardNavigationEnabled="{Binding IsWrappingKeyboardNavigationEnabled, Mode=OneWay}"
                        ItemTemplate="{StaticResource ItemTemplate}"
                        VirtualizingPanel.CacheLengthUnit="{Binding CacheUnit, Mode=OneWay}"
                        VirtualizingPanel.CacheLength="{Binding CacheLength, Mode=OneWay}"
                        VirtualizingPanel.ScrollUnit="{Binding ScrollUnit, Mode=OneWay}"
                        VirtualizingPanel.VirtualizationMode="{Binding VirtualizationMode, Mode=OneWay}"
                        VirtualizingPanel.IsVirtualizingWhenGrouping="True"
                        ScrollViewer.HorizontalScrollBarVisibility="{Binding HorizontalScrollBarVisibility, Mode=TwoWay}"
                        ScrollViewer.VerticalScrollBarVisibility="{Binding VerticalScrollBarVisibility, Mode=TwoWay}"
                        Orientation="{Binding Orientation, Mode=OneWay}"
                        SpacingMode="{Binding SpacingMode, Mode=OneWay}"
                        StretchItems="{Binding StretchItems, Mode=OneWay}"/>
                </DockPanel>
            </TabItem>
            <TabItem Header="GridDetailsView">
                <DockPanel>
                    <StackPanel DockPanel.Dock="Top" Style="{StaticResource DescriptionAndOptionsBarStyle}">
                        <TextBlock
                            VerticalAlignment="Center" 
                            Text="The GridDetailsView control is a easy to use control displaying a grid of items with the ability to expand items when clicked." />
                    </StackPanel>
                    <wpftk:GridDetailsView
                        Style="{StaticResource ItemsControlStyle}"
                        ItemTemplate="{StaticResource ItemTemplate}"
                        VirtualizingPanel.CacheLengthUnit="{Binding CacheUnit, Mode=OneWay}"
                        VirtualizingPanel.CacheLength="{Binding CacheLength, Mode=OneWay}"
                        VirtualizingPanel.ScrollUnit="{Binding ScrollUnit, Mode=OneWay}"
                        VirtualizingPanel.VirtualizationMode="{Binding VirtualizationMode, Mode=OneWay}"
                        VirtualizingPanel.IsVirtualizingWhenGrouping="True"
                        ScrollViewer.HorizontalScrollBarVisibility="{Binding HorizontalScrollBarVisibility, Mode=TwoWay}"
                        ScrollViewer.VerticalScrollBarVisibility="{Binding VerticalScrollBarVisibility, Mode=TwoWay}"
                        Orientation="{Binding Orientation, Mode=OneWay}"
                        SpacingMode="{Binding SpacingMode, Mode=OneWay}"
                        StretchItems="{Binding StretchItems, Mode=OneWay}">
                        <wpftk:GridDetailsView.ExpandedItemTemplate>
                            <DataTemplate DataType="local:TestItem">
                                <TextBlock
                                    Background="Gray"
                                    FontSize="64"
                                    Text="{Binding Number}"
                                    Padding="16"
                                    Margin="8" />
                            </DataTemplate>
                        </wpftk:GridDetailsView.ExpandedItemTemplate>
                    </wpftk:GridDetailsView>
                </DockPanel>
            </TabItem>
            <TabItem Header="Material Design">
                <DockPanel>
                    <DockPanel.Resources>
                        <ResourceDictionary>
                            <ResourceDictionary.MergedDictionaries>
                                <materialDesign:BundledTheme BaseTheme="Light" PrimaryColor="DeepPurple" SecondaryColor="Lime" />
                                <ResourceDictionary Source="pack://application:,,,/MaterialDesignThemes.Wpf;component/Themes/MaterialDesign2.Defaults.xaml" />
                            </ResourceDictionary.MergedDictionaries>
                        </ResourceDictionary>
                    </DockPanel.Resources>
                    <StackPanel DockPanel.Dock="Top" Style="{StaticResource DescriptionAndOptionsBarStyle}">
                        <TextBlock 
                            VerticalAlignment="Center" 
                            Text="A VirtualizingWrapPanel used by a MaterialDesign ListView as ItemsPanel." />
                    </StackPanel>
                    <ListView    
                        Style="{StaticResource ItemsControlStyle}"
                        ItemTemplate="{StaticResource ItemTemplate}"                                 
                        VirtualizingPanel.CacheLengthUnit="{Binding CacheUnit, Mode=OneWay}"
                        VirtualizingPanel.CacheLength="{Binding CacheLength, Mode=OneWay}"
                        VirtualizingPanel.ScrollUnit="{Binding ScrollUnit, Mode=OneWay}"
                        VirtualizingPanel.VirtualizationMode="{Binding VirtualizationMode, Mode=OneWay}"
                        VirtualizingPanel.IsVirtualizingWhenGrouping="True"
                        ScrollViewer.CanContentScroll="True"
                        ScrollViewer.HorizontalScrollBarVisibility="{Binding HorizontalScrollBarVisibility, Mode=TwoWay}"
                        ScrollViewer.VerticalScrollBarVisibility="{Binding VerticalScrollBarVisibility, Mode=TwoWay}">
                        <ListView.ItemsPanel>
                            <ItemsPanelTemplate>
                                <wpftk:VirtualizingWrapPanel
                                    Orientation="{Binding DataContext.Orientation, Mode=OneWay, ElementName=window}"
                                    SpacingMode="{Binding DataContext.SpacingMode, Mode=OneWay, ElementName=window}"
                                    StretchItems="{Binding DataContext.StretchItems, Mode=OneWay, ElementName=window}"
                                    ScrollLineDelta="{Binding DataContext.ScrollLineDelta, Mode=OneWay, ElementName=window}"
                                    MouseWheelDelta="{Binding DataContext.MouseWheelDelta, Mode=OneWay, ElementName=window}"
                                    ScrollLineDeltaItem="{Binding DataContext.ScrollLineDeltaItem, Mode=OneWay, ElementName=window}"
                                    MouseWheelDeltaItem="{Binding DataContext.MouseWheelDeltaItem, Mode=OneWay, ElementName=window}"                                                                    
                                    IsGridLayoutEnabled="{Binding DataContext.IsGridLayoutEnabled, Mode=OneWay, ElementName=window}"/>
                            </ItemsPanelTemplate>
                        </ListView.ItemsPanel>
                    </ListView>
                </DockPanel>
            </TabItem>
            <TabItem Header="WrapPanel (no virtualization)" Visibility="Collapsed">
                <DockPanel>
                    <StackPanel DockPanel.Dock="Top" Style="{StaticResource DescriptionAndOptionsBarStyle}">
                        <TextBlock
                            VerticalAlignment="Center"
                            Text="For comparison this is a ListView using a standard WrapPanel as ItemsPanel." />
                    </StackPanel>
                    <ListView
                        Margin="0,2,0,0"
                        ItemTemplate="{StaticResource ItemTemplate}"
                        ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                        <ListView.ItemsPanel>
                            <ItemsPanelTemplate>
                                <WrapPanel/>
                            </ItemsPanelTemplate>
                        </ListView.ItemsPanel>
                    </ListView>
                </DockPanel>
            </TabItem>
        </TabControl>
    </DockPanel>
</Window>